# OSPF Areas and LSAs

## Scaling OSPF with Areas
- OSPF Areas Overview
  - Areas add hierarchy and scalability to OSPF
  - An area defines a flooding domain
    - All devices in the area agree on the topology
    - Changes inside the area require LSA flooding and full SPF
  - Routing between areas hides topology details
    - Inter-area routing is similar to distance vector
    - Changes outside the area don't always require LSA flooding or SPF
    - Limits impact on router resources
- OSPF Two-Level Hierarchy
  - Backbone Area
    - Area 0 (0.0.0.0)
    - Used to summarize topology information between other areas
    - Traffic from one area to another must pass through area 0
    - Must be contiguous
  - Non-Backbone Areas
    - All other areas 1 - 2^32 (0.0.0.1 = 255.255.255.255)
    - Must use connections to area 0 to reach other areas
- OSPF Router Types
  - Backbone Routers
    - At least one link in area 0
    - Will know the SPT for Area 0
  - Internal Routers
    - All links in one non-backbone area
    - Will not know the SPT for Area 0
  - Area Border Router (ABR)
    - Links in both area 0 and in non-backbone area(s)
    - Used to summarize information between area 0 and non-backbone area
    - Uses LSA Type 3 (Network Summary LSA)
  - Autonomous System Boundary Router (ASBR)
    - At least one link in the OSPF domain
    - At least one link outside the OSPF domain
      - EIGRP, IS-IS, BGP, etc.
    - Used to redistribute information to/from other routing domains and OSPF

## OSPF LSA Types
- LSA types 1-7
  - Type 1 - Router LSA
  - Type 2 - Network LSA
  - Type 3 - Network Summary LSA
  - Type 4 - ASBR Summary LSA
  - Type 5 - External LSA
  - Type 6 - Multicast LSA
    - MOSPF not implemented by most vendors
  - Type 7 - NSSA External LSA
  - Types 8, 9, 10 - Opaque LSA
    - Used for extensibility
    - E.g. MPLS Traffic Engineering
- LSA types sent/received depends on:
  - Router's type
  - OSPF Network Type
  - Area Type
- LSAs are grouped together by 3 route types:
  - Intra-Area Routes (O)
    - LSA Types 1 & 2
  - Inter-Area Routes (O IA)
    - LSA Types 3 & 4
  - External Routes
    - E1/E2
      - LSA Type 5
    - N1/N2
      - LSA Type 7

## OSPF Path Selection
### Inter-Area Path Selection

- LSA Type 1 - Router LSA
  - Generated by every router in the OSPF domain
    - Not flooded outside the area they originate in
  - Describes it's directly connected links
    - What are my link costs
    - Who are my neighbors
  - Used to build the graph for intra-area SPF
- LSA Type 2 - Network LSA
  - Generated by the Designated Router (DR) on broadcast and non-broadcast network types
    - Not flooded outside the area they originate in
  - Describes who is adjacent with the DR
    - What is my link cost to the DR
    - Implies my link cost to all others adjacent to that DR
  - Used to reduce redundant information in the database
    - n*(n-1)/2 and flooding scalability issue

### Intra-Area Path Selection
- LSA Type 3 - Network Summary LSA
  - Generated by ABR
    - Flooded from area 0 into non-backbone areas and vice-versa
  - Describes ABR's reachability to links in other areas
    - Includes cost, but hides ABR's actual path to destination
  - SPF not run for ABR advertised routes
    - ABR can reach link A via SPT in cost X
    - I can reach ABR via SPT in cost Y
    - Implies I can reach link A via SPT in cost X + Y
  - This is why inter-area routing is like distance vector
- LSA Type 4 - ASBR Summary LSA
  - Generated by ABR
    - Flooded from area 0 into non-backbone area and vice-versa
  - Describes ABR's reachability to ASBRs in other areas
    - Includes cost, but hides ABR's actual path to destination
  - SPF not run to reach inter-area ASBR
    - ABR can reach ASBR via SPT in cost X
    - I can reach ABR via SPT in cost Y
    - Implies I can reach ASBR via SPT in cost X + Y
  - Inter-area external routing is also like distance vector

### External Path Selection

- LSA Type 5 - External LSA
  - Generated by ASBR
    - Flooded to all non-stub areas
  - Describes routes ASBR is redistributing
    - Metric
    - Metric Type
      - Type 1 = E1
      - Type 2 = E2 (default)
    - Forward Address
      - Who should I route towards to reach the link?
      - Usually the ASBR itself, but could be someone else in some designs
    - Route Tag

#### External LSA Routes
    
- External Type 1 vs Type 2
  - External route type controls how metric for external link is calculated
    - Type 1 (E1)
      - Takes the cost the ASBR reports in plus the cost to the ASBR
    - Type 2 (E2)
      - Take just the cost the ASBR reports in
      - If there is a tie, then take the cost to the ASBR as well
    - Type 1 is preferred over Type 2
  - External Route Calculation
    - Performs like distance vector routing similar to inter-area calculation
    - Intra-area externals
      - ASBR can reach link A in cost X
      - I can reach ASBR via SPT in cost Y
      - I can reach link A via SPT in cost X + Y
    - Inter-area externals
      - ASBR can reach link A in cost X
      - ABR can reach ASBR via SPT in Cost Y
      - I can reach ABR via SPT in cost Z
      - I can reach link A via SPT in cost X + Y + Z